<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>

<%@ include file="./include/header.jsp" %>


<section>
  <div class="container regist-container">
    <p class="title">게시판 등록</p>
    <div class="form-box">
      <form action="${pageContext.request.contextPath}/regist" method="post" name="registForm">
        <div class="writerPw">
          <div class="writer-box">
	        <div class="input-line writer-input">
        	  <label for="writer">작성자</label>
	          <input class="form-control" type="text" id="writer" name="writer" maxlength="10" placeholder='최대 10자'>
	        </div>
           </div>
          <div class="pw-box">
	        <div class="input-line pw-input">
              <label for="password">비밀번호</label>
              <input class="form-control" type="password" id="password" name="password" maxlength="15" placeholder="영문, 숫자, 특수문자(@$!%*?&) 포함 8자~15자">
            </div>
          </div>
        </div>
        <div class="input-line title-input">
          <label for="title">글제목</label>
          <input class="form-control" type="text" id="title" name="title" maxlength="50" placeholder="50자 이내">
          <span id="titleCheck" class="title-fail"></span>
        </div>
        <div class="input-line content-input">
          <label for="content">내용</label>
          <textarea class="form-control content" id="content" rows="10" name="content" maxlength="500" oninput=checkContentLength()></textarea>
          <span id="contentLength">0/500</span>
        </div>
        <div class="titlefoot">
          <button class="btn regist-btn btn-outline-primary" id="registBtn" type="button">등록</button>
          <button type="button" class="btn list-btn btn-outline-primary" onclick="location.href='${pageContext.request.contextPath}/list'">목록</button>
        </div>
      </form>
    </div>   
  </div>
</section>



<script>
  const $password = document.getElementById('password');

  //작성자 검증
  const writerInput = document.getElementById("writer");

  writerInput.addEventListener("input", function() {
      const maxLength = 10;
      const inputValue = writerInput.value;

      // HTML 태그를 제거하고 공백을 포함한 총 10자리까지만 유지
      const sanitizedValue = inputValue.replace(/<\/?[^>]+(>|$)/g, "");
      if (sanitizedValue.length >= maxLength) {
          writerInput.value = sanitizedValue.substring(0, maxLength);
          writerInput.removeEventListener("input", inputHandler);
          alert("작성자는 최대 10자까지만 입력 가능합니다.");
      }
  });

  function inputHandler() {
      const maxLength = 10;
      const inputValue = writerInput.value;

      // HTML 태그를 제거하고 공백을 포함한 총 10자리까지만 유지
      const sanitizedValue = inputValue.replace(/<\/?[^>]+(>|$)/g, "");
      if (sanitizedValue.length >= maxLength) {
          writerInput.value = sanitizedValue.substring(0, maxLength);
          writerInput.removeEventListener("input", inputHandler);
          alert("작성자는 최대 10자까지만 입력 가능합니다.");
      }
  }

  writerInput.addEventListener("input", inputHandler);


  //비밀번호 검증
  let isValidPassword = true;
  let isPasswordAlertShown = false;

  $password.addEventListener('input', function(event) {
    const passwordRegex = /^(?=.*[a-zA-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,15}$/;
    isValidPassword = passwordRegex.test($password.value);
    isPasswordAlertShown = false;
  });

  $password.addEventListener('blur', function(event) {
    if (!isValidPassword && !isPasswordAlertShown) {
      alert('비밀번호는 8자 이상 15자 이하의 영문, 숫자, 특수문자를 모두 포함해야 합니다.');
      $password.value = '';
      $password.focus();
      isPasswordAlertShown = true;
    }
  });

  //제목 검증
	const titleInput = document.getElementById("title");

    titleInput.addEventListener("input", function() {
        const maxLength = 50;
        const inputValue = titleInput.value;

        // HTML 태그를 제거하고 공백을 포함한 총 10자리까지만 유지
        const sanitizedValue = inputValue.replace(/<\/?[^>]+(>|$)/g, "");
        if (sanitizedValue.length >= maxLength) {
        	titleInput.value = sanitizedValue.substring(0, maxLength);
        	titleInput.removeEventListener("input", inputHandler);
            alert("작성자는 50자까지만 입력 가능합니다.");
        }
    });

    function inputHandler() {
        const maxLength = 50;
        const inputValue = titleInput.value;

        // HTML 태그를 제거하고 공백을 포함한 총 50자리까지만 유지
        const sanitizedValue = inputValue.replace(/<\/?[^>]+(>|$)/g, "");
        if (sanitizedValue.length >= maxLength) {
        	titleInput.value = sanitizedValue.substring(0, maxLength);
        	titleInput.removeEventListener("input", inputHandler);
            alert("제목은 50자까지만 입력 가능합니다.");
        }
    }

    titleInput.addEventListener("input", inputHandler);


	//내용 검증  
    const contentTextarea = document.getElementById("content");

   contentTextarea.addEventListener("input", function(event) {
       const maxLength = 500;
       const inputValue = contentTextarea.value;

       // HTML 태그를 제거하고 정제된 값의 길이를 체크
       const sanitizedValue = inputValue.replace(/<\/?[^>]+(>|$)/g, "");
       if (sanitizedValue.length >= maxLength) {
           contentTextarea.value = sanitizedValue.substring(0, maxLength);
           event.preventDefault();
           alert("글자 수는 500자까지만 입력 가능합니다.");
       }
   });
   
   $content.addEventListener('keyup', function(event) {
		  if ($content.value.length >= 500 && !event.ctrlKey) {
		    $content.value = $content.value.slice(0, 500);
		    checkContentLength();
		    alert('내용은 최대 500자입니다.');
		  } else {
		    checkContentLength();
		  }
		}); 
   

 //내용 글자수
   function checkContentLength() {
 	  const contentValue = $content.value; 
 	  const contentLength = contentValue.length;
 	  document.getElementById('contentLength').textContent = contentTextarea.value.length + '/500';
   } 
   
   

  document.getElementById('registBtn').addEventListener('click', function() {
    const form = document.forms['registForm'];
    if (form.writer.value.trim() == '') {
      alert('작성자를 입력하세요.');
      form.writer.focus();
    } else if(form.password.value.trim() =='') {
      alert('비밀번호를 입력하세요.');
	  form.password.focus();
    } else if (form.title.value.trim() ==''){
      alert('제목을 입력하세요.');
      form.title.focus();
    } else if (form.content.value.trim() ==''){
      alert('글 내용을 입력하세요.');
      form.content.focus();
    } else {
      form.submit();
    }
  });




</script>

<%@ include file="./include/footer.jsp" %>